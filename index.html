<!doctype html>
<head>
    <script src="Phys.js" type="text/javascript"></script>
</head>
<canvas id="view" width="300" height="300" style="border:2px inset";></canvas>
<script type="application/javascript">
	var raf = function() { };
	var raf = requestAnimationFrame;
	
	var view = document.getElementById("view"),
		vctx=view.getContext("2d"),
		vw=view.width,vc=vw/2,vh=view.height;
	
	vctx.fillStyle="red";
	
	var fullCircle = Math.PI * 2;

	var scale = 80;
	var p=new Phys(), hitTime;
	p.reset = function reset() {
		p.position = 0;
		p.velocity = 5*scale;
		p.acceleration = -9.8*scale;
		//p.moment();
		
		hitTime = Phys.predict.time.byPosition(p, 0);
	};
	p.reset();
	
	var bounce = 0.9;
	var prevFrame = Date.now(), currentFrame, deltaFrame;
	raf(function render(){
		currentFrame = Date.now();
		deltaFrame = (currentFrame-prevFrame)/1000;
		prevFrame=currentFrame;
		
		if(hitTime < deltaFrame){
			p.simulate(hitTime); //p.moment();
			p.positon = 0; // correct position
			p.velocity=-p.velocity*bounce; // bounce
			//p.moment();
			//console.log(p);
			deltaFrame-=hitTime;
			//document.title = ("at hitTime = "+p.position);
			//p.position=0;
			hitTime = Phys.predict.time.byPosition(p, 0);
			if(!hitTime){
				p.position=p.velocity =p.acceleration = 0;
				//p.moment();
				console.log("at rest");
			}
			p.simulate(deltaFrame);
		}
		else{
			hitTime-=deltaFrame;
			p.simulate(deltaFrame);
		}
		
		//console.log("position =", p.position);
		
		vctx.clearRect(0,0,vw,vh);
		
		vctx.beginPath();
		vctx.arc(vc, vh-p.position, 10, 0, fullCircle, true);
		//console.log(p.position);
		
		vctx.fill();
		
		raf(render);
	});
	
	view.addEventListener("click", function() {
		p.reset();
	});
	
</script>
